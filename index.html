<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—å½“ã¦ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #eef2f3;
        }
        #game-container {
            text-align: center;
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 350px;
            position: relative;
        }
        #bgm-control {
            /* â˜…ä¿®æ­£ï¼šabsoluteã®ã¾ã¾ã§OKã§ã™ãŒã€æ ã®ç«¯ã«åˆã‚ã›ã¾ã™ */
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: rgba(248, 249, 250, 0.9); /* å°‘ã—èƒŒæ™¯ã‚’æ˜ã‚‹ã */
            padding: 8px;
            border-radius: 12px;
            border: 1px solid #ddd;
        }
        .settings {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        #display-area {
            font-size: 3.5rem;
            font-weight: bold;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            color: #333;
            letter-spacing: 2px;
            text-align: center;
        }
        .stats {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }
        .stats div {
            margin: 2px 0; /* è¡Œé–“ã‚’å°‘ã—ä½œã‚‹ã¨è¦‹ã‚„ã™ããªã‚Šã¾ã™ */
        }
        input[type="number"] {
            font-size: 1.5rem;
            padding: 10px;
            width: 80%;
            margin-bottom: 10px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            transition: all 0.2s;
            font-weight: bold;
        }
        button:hover { background-color: #357abd; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #message { margin-top: 15px; font-weight: bold; min-height: 1.5em; }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>

<div id="game-container">
    <h2>æ•°å­—å½“ã¦ã‚²ãƒ¼ãƒ </h2>

    <div id="bgm-control" style="position: absolute; top: 10px; right: 10px; z-index: 100; background: rgba(255,255,255,0.8); padding: 10px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
        <button id="bgm-btn" onclick="toggleBGM()" style="background-color: #f39c12; padding: 8px 15px; font-size: 0.8rem; margin-bottom: 8px; width: 100%;">BGM: OFF</button>
        <div style="display: flex; align-items: center; gap: 5px;">
            <span style="font-size: 0.7rem;">ğŸ”ˆ</span>
            <input type="range" id="volume-control" min="0" max="1" step="0.05" value="0.5" style="width: 80px; cursor: pointer;">
            <span style="font-size: 0.7rem;">ğŸ”Š</span>
        </div>
    </div>
    <audio id="bgm" src="https://senamagu.github.io/Guessthenumber.github.io/è¿½ã„ã‹ã‘ã£ã“ã‚­ãƒ£ãƒƒãƒãƒ¼.mp3" loop></audio>
    
    <div id="bgm-control" style="position: absolute; top: 10px; right: 10px; z-index: 100;">
        <button id="bgm-btn" onclick="toggleBGM()" style="background-color: #f39c12; padding: 8px 15px; font-size: 0.8rem;">BGM: OFF</button>
    </div>
    
    <div class="settings" id="setup-section">
        <label>æ¡æ•°è¨­å®š: 
            <input type="number" id="digit-select" value="4" min="1" max="10" style="width: 50px; font-size: 1rem; padding: 2px;">
        </label>
    </div>
    
    <div class="score-board">
         æ­£è§£: <span id="correct-count">0</span> | 
         ä¸æ­£è§£: <span id="wrong-count">0</span>
    </div>
    
    <div class="stats">
        <div>ç¾åœ¨ã®è¡¨ç¤ºé€Ÿåº¦: <span id="current-speed">0.20</span>ç§’</div>
        <div>ç¾åœ¨ã®æ¡æ•°: <span id="current-digits">4</span>æ¡</div>
    </div>

    <div id="display-area">Ready?</div>
    
    <div id="input-section" style="display:none;">
        <input type="number" id="user-input" placeholder="ï¼Ÿ" />
        <br>
        <button id="submit-btn" onclick="checkAnswer()">å›ç­”ã™ã‚‹</button>
    </div>

    <button id="back-to-title-btn" onclick="backToTitle()" style="display:none; background-color: #6c757d;">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    <button id="start-btn" onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    <div id="message"></div>
</div>

<script>
    let correctTotal = 0;// ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®å¤‰æ•°
    let wrongTotal = 0;// ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®å¤‰æ•°
    let targetNumber = "";
    let displayTime = 200; // åˆæœŸå€¤ 0.2ç§’
    const MIN_TIME = 1;   // æœ€é€Ÿ 0.001ç§’

    const volumeControl = document.getElementById('volume-control');
    const displayArea = document.getElementById('display-area');
    const userInput = document.getElementById('user-input');
    const inputSection = document.getElementById('input-section');
    const startBtn = document.getElementById('start-btn');
    const submitBtn = document.getElementById('submit-btn');
    const message = document.getElementById('message');
    const speedText = document.getElementById('current-speed');
    const digitInput = document.getElementById('digit-select');
    const soundCount = new Audio('https://senamagu.github.io/Guessthenumber.github.io/ã‚«ã‚¦ãƒ³ãƒˆ.mp3'); // ã‚«ã‚¦ãƒ³ãƒˆéŸ³
ã€€ã€€ const soundSuccess = new Audio('https://senamagu.github.io/Guessthenumber.github.io/æˆåŠŸ.mp3'); // æ­£è§£éŸ³
ã€€ã€€ const soundError = new Audio('https://senamagu.github.io/Guessthenumber.github.io/å¤±æ•—.mp3'); // ä¸æ­£è§£éŸ³
    const soundtap = new Audio('https://senamagu.github.io/Guessthenumber.github.io/ã‚¿ãƒƒãƒ—éŸ³.mp3'); // ã‚¿ãƒƒãƒ—éŸ³

    const bgm = document.getElementById('bgm');
const bgmBtn = document.getElementById('bgm-btn');
let isBgmPlaying = false;

  function toggleBGM() {
      if (isBgmPlaying) {
          bgm.pause();
          bgmBtn.textContent = "BGM: OFF";
          bgmBtn.style.backgroundColor = "#f39c12";
      } else {
          // ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™å¯¾ç­–ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ(ã‚¯ãƒªãƒƒã‚¯)æ™‚ã«å†ç”Ÿ
          bgm.play().catch(e => console.log("å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e));
          bgmBtn.textContent = "BGM: ON";
          bgmBtn.style.backgroundColor = "#e74c3c"; // ONã®æ™‚ã¯è‰²ã‚’å¤‰ãˆã‚‹
      }
      isBgmPlaying = !isBgmPlaying;
  }

// éŸ³é‡ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹é–¢æ•°
function updateVolume() {
    const vol = volumeControl.value;
    
    // BGMã®éŸ³é‡
    if (typeof bgm !== 'undefined') bgm.volume = vol;
    
    // å„ç¨®åŠ¹æœéŸ³ã®éŸ³é‡ 
    soundCount.volume = vol;
    soundSuccess.volume = vol;
    soundError.volume = vol;
    soundtap.volume = vol;
}
// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
volumeControl.addEventListener('input', updateVolume);

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸéŸ³é‡ã‚’åæ˜ 
updateVolume();

    
    function startGame() {
        // â˜…ãƒœã‚¿ãƒ³ã‚’å†è¡¨ç¤ºã—ã€å…¥åŠ›æ¬„ã®å›ºå®šã‚’è§£é™¤ã™ã‚‹
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.style.display = 'inline-block';
        userInput.readOnly = false;
        soundSuccess.pause();
        soundSuccess.currentTime = 0; 
        soundError.pause();
        soundError.currentTime = 0; 
        soundCount.currentTime = 0; 
        soundCount.play();
        startBtn.style.display = 'none';
        const digits = digitInput.value;
        document.getElementById('current-digits').textContent = digits;
        document.getElementById('back-to-title-btn').style.display = 'none';
        document.getElementById('setup-section').style.display = 'none';
        inputSection.style.display = 'none';
        message.textContent = "";
        userInput.value = "";
        
        let timeLeft = 3.0;
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
        const timer = setInterval(() => {
            displayArea.style.color = "#333";
            displayArea.textContent = timeLeft.toFixed(1);
            timeLeft -= 0.1;

            if (timeLeft < 0) {
                clearInterval(timer);
                showNumber();
            }
        }, 100);
    }

function backToTitle() {
    // ã‚¹ã‚³ã‚¢ã¨é€Ÿåº¦ã®ãƒªã‚»ãƒƒãƒˆ
    correctTotal = 0;
    wrongTotal = 0;
    displayTime = 200;
    document.getElementById('correct-count').textContent = "0";
    document.getElementById('wrong-count').textContent = "0";
    document.getElementById('current-speed').textContent = "0.20";

    // ç”»é¢è¡¨ç¤ºã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
    document.getElementById('setup-section').style.display = 'block'; // æ¡æ•°å¤‰æ›´ã‚’è¨±å¯
    startBtn.style.display = 'inline-block';
    startBtn.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆï¼";
    document.getElementById('back-to-title-btn').style.display = 'none';
    document.getElementById('setup-section').style.display = 'block';
    document.getElementById('current-digits').textContent = digitInput.value;
    inputSection.style.display = 'none';
    displayArea.style.color = "#333";
    displayArea.textContent = "Ready?";
    message.textContent = "";
}
    
    function showNumber() {
        // æŒ‡å®šã•ã‚ŒãŸæ¡æ•°ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆ
        soundCount.pause();
        soundCount.currentTime = 0; 
        const digits = parseInt(digitInput.value);
        const min = Math.pow(10, digits - 1);
        const max = Math.pow(10, digits) - 1;
        targetNumber = Math.floor(min + Math.random() * (max - min + 1)).toString();
        displayArea.textContent = targetNumber;
        displayArea.style.color = "#333";

        // å‹•çš„ãªè¡¨ç¤ºæ™‚é–“ã§æ¶ˆå»
        setTimeout(() => {
       ã€€ã€€  displayArea.textContent = "*".repeat(digits);//æ¡æ•°åˆ†ã ã‘ã€Œ*ã€ã‚’è¡¨ç¤ºã™ã‚‹
            displayArea.style.color = "#333";//ã€Œ*ã€ã®è‰²
            submitBtn.style.display = 'inline-block';//å›ç­”ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
            userInput.style.display = 'inline-block';//è§£ç­”æ¬„ã®è¡¨ç¤º
            inputSection.style.display = 'block';//ãŸã®ã‚€ã€åå¿œã—ã¦ãã‚Œ
            userInput.focus();//ã‚«ãƒ¼ã‚½ãƒ«ã®ç§»å‹•
        }, displayTime);
    }

    function checkAnswer() {
    // â˜…å›ç­”ãƒœã‚¿ãƒ³ã ã‘ã‚’éè¡¨ç¤ºã«ã™ã‚‹
    submitBtn.style.display = 'none';
    // å…¥åŠ›æ¬„ã¯è§¦ã‚Œãªã„ã‚ˆã†ã«å›ºå®šã™ã‚‹ï¼ˆæ›¸ãæ›ãˆé˜²æ­¢ï¼‰
    userInput.readOnly = true;
        if (userInput.value === targetNumber) {
            soundSuccess.play();
            correctTotal++; // 1å¢—ã‚„ã™
            document.getElementById('correct-count').textContent = correctTotal; // ç”»é¢ã‚’æ›´æ–°
            displayArea.textContent = targetNumber;
            displayArea.style.color = "#2ecc71";
            message.textContent = "æ­£è§£ï¼ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼";
            message.className = "success";
            // æ­£è§£ã—ãŸã‚‰0.02ç§’ãšã¤é€Ÿãã™ã‚‹ï¼ˆæœ€ä½0.05ç§’ã¾ã§ï¼‰
            displayTime = Math.max(MIN_TIME, displayTime - 20);
            speedText.textContent = (displayTime / 1000).toFixed(2);
        } else {
            soundError.play();
            wrongTotal++; // 1å¢—ã‚„ã™
            document.getElementById('wrong-count').textContent = wrongTotal; // ç”»é¢ã‚’æ›´æ–°
            displayArea.textContent = targetNumber;
            displayArea.style.color = "#e74c3c";
            message.textContent = `ä¸æ­£è§£ï¼ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ€ã‚¦ãƒ³ï¼`;
            message.className = "error";
            // å¤±æ•—ã—ãŸã‚‰å°‘ã—é›£æ˜“åº¦ã‚’æˆ»ã™
            displayTime += 10;
            speedText.textContent = (displayTime / 1000).toFixed(2);
        }
        
        startBtn.style.display = 'inline-block';
        startBtn.textContent = "æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸";
        document.getElementById('back-to-title-btn').style.display = 'inline-block';
    }

    userInput.addEventListener("keyup", function(event) {
        if (event.key === "Enter") checkAnswer();
    });
</script>

</body>
</html>
